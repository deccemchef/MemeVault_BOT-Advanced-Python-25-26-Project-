# Взаимодействие с пользователем

Пользователь начинает работу с ботом, открывая диалог и инициируя общение. После первого обращения бот представляется и кратко объясняет своё назначение: он помогает находить мемы по ключевым словам и позволяет сохранять понравившиеся изображения в личный список избранного. Таким образом, пользователь заранее понимает, какие функции доступны и как с ними работать.

Основной сценарий взаимодействия заключается в том, что пользователь отправляет боту любое слово или фразу, которые он хочет использовать как критерий поиска. Бот воспринимает каждое подобное сообщение как запрос на подборку мемов. В ответ он выдаёт несколько подходящих изображений или гифок, подобранных на основе заранее назначенных тегов. Пользователь получает подборку, просматривает её и выбирает понравившиеся материалы.

Для сохранения понравившихся мемов у пользователя есть отдельная команда. После выполнения поиска он сможет сохранить один из найденных вариантов в свой список избранного, не покидая текущего диалога. У каждого пользователя внутри бота есть собственный независимый набор избранных мемов, который формируется постепенно, по мере взаимодействия.

Когда пользователю захочется вернуться к сохранённым мемам, он использует другую команду, позволяющую запросить свой список избранного. Бот отправит пользователю все изображения, которые тот отметил ранее. Пользователь может обращаться к этому списку в любое время, повторно просматривать мемы или использовать их для пересылки кому-либо.

# Текущие задачи

# 1. Разработка и развертывание Telegram-бота (Работают все)
(ориентировочные сроки: до 05.12)

## 1.1. Создание базы проекта
- Создать репозиторий проекта
- Добавить начальную структуру
- Подготовить виртуальное окружение

## 1.2. Получение и защита токена бота
- Создать бота в BotFather
- Создать файл .env для хранения токена
- Написать код загрузки токена из переменных окружения
- Убедиться, что токен нигде не логируется и не выводится

## 1.3. Установка и настройка инфраструктуры бота
- Создать базовый каркас бота 
- Настроить обработку ошибок
- Настроить логирование 

## 1.4. Реализация базового функционала диалога
- Реализовать общение с пользователем
- Реализовать механизм обработки текстовых запросов
- Добавить структуру хранения «сессий пользователя» для временных данных 

## 1.5. Тестирование этапа
- Юнит-тесты на загрузку токена
- Юнит-тесты на обработчики
- Тестирование запуска бота локально
- Проверка, что токен не попадает в вывод консоли и логов
- Проверка, что .env не попадает в репозиторий


# 2. Проектирование и создание базы данных (Работают все)
(ориентировочные сроки: до 10.12)

## 2.1. Разработка модели данных
- Определить сущности
- Определить ключи, индексы, связи
- Составить ER-диаграмму

## 2.2. Создание физической базы данных
- Создать файл БД
- Написать SQL-скрипт создания таблиц (ORM)
- Проверить корректность индексов и связей

## 2.3. Подключение БД к проекту
- Добавить модуль для взаимодействия с БД
- Реализовать функции:
  - добавление мема
  - добавление тегов
  - поиск по тегам
  - сохранение избранного
  - получение списка избранного
- Настроить автоматическую инициализацию БД при запуске проекта

## 2.4. Тестирование этапа
- Юнит-тесты для самых базовых действий с данными бд
- Тесты на корректность связей многие-ко-многим
- Тесты на индексацию
- Тестирование устойчивости БД при ошибочных данных


# 3. Создание приватного канала и заполнение базы данных мемами (Варвара и Александра)
(ориентировочные сроки: 1 день после развертывания и проверки работоспособности БД)

## 3.1. Создание и настройка приватного канала
- Создать приватный Telegram-канал
- Добавить туда бота и назначить его администратором
- Проверить, что бот получает события channel_post

## 3.2. Разработка функционала для сбора мемов
- Реализовать обработчики:
  - получения изображений
  - получения GIF
  - обработки подписей как тегов
- Автоматически сохранять file_id, тип медиа и теги в БД
- Создать гибкую систему парсинга тегов

## 3.3. Заполнение БД через канал
- Собрать подборку мемов и отправить ее в канал
- Проверять, что бот их корректно записывает в БД и что данные корректны

## 3.4. Тестирование этапа
- Тестирование корректности обработки медиа в канале
- Тестирование сохранения в БД
- Проверка корректности тегов и связей
- Проверка устойчивости при некорректных файлах или подписях


# 4. Реализация пользовательских функций (Два человека, смотрим по загруженности)
(ориентировочные сроки: 17.12)

## 4.1. Поиск мемов по тегам
- Реализовать алгоритм поиска по тегам
- Сортировка результатов
- Выводить несколько подходящих мемов

## 4.2. Сохранение мемов в избранное
- Обработать команду добавления в избранное
- Хранить соответствие «пользователь → мем»

## 4.3. Вывод избранных мемов
- Реализовать команду просмотра избранного
- Сортировать избранные по дате добавления

## 4.4. Общие улучшения
- Обработать ошибки и невалидные команды
- Сделать понятные текстовые ответы пользователю
- Минимизировать спам и прочие отклонения в поведении

## 4.5. Тестирование
- Тесты на функциональность поиска
- Тесты на избранное
- Тесты на команды пользователя
- Проверка стабильности при большом количестве запросов
- Ручное тестирование всех основных сценариев


# 5. Работа с безопасностью и защитой данных (Все)
(ориентировочные сроки: до 20.12)

## 5.1. Секреты
- Токен хранится в .env
- .env добавлен в .gitignore
- В репозитории нет токена, префиксов токена или ссылок на него

## 5.2. Логирование
- В логах нет токена
- В логах нет полного пути к базе
- Ошибки выводятся безопасно

## 5.3. Финальные тесты безопасности
- Проверка .gitignore
- Проверка корректности переменных окружения
- Перепроверка, что токены не утекли на GitHub

![diagram](ER.svg)
